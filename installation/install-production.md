<!--[metadata]>
+++
aliases = [ "/ucp/production-install/"]
title = "Install UCP for production"
description = "Learn how to install Docker Universal Control Plane on production"
keywords = ["Universal Control Plane, UCP, install"]
[menu.main]
parent="mn_ucp_installation"
identifier="ucp_install_production"
weight=20
+++
<![end-metadata]-->

# Install UCP for production

Docker Universal Control Plane (UCP) is a containerized application that can be
installed on-premises or on a cloud infrastructure.

If you're installing Docker Datacenter on Azure, [follow this guide](https://success.docker.com/?cid=ddc-on-azure).

## Step 1: Validate the system requirements

The first step in installing UCP, is ensuring your
infrastructure has all the [requirements UCP needs to run](system-requirements.md).


## Step 2: Install CS Docker on all nodes

UCP requires you to install Docker CS Engine 1.12.0 or above on all nodes of
your UCP cluster.

[Install CS Docker Engine](https://docs.docker.com/docker-trusted-registry/cs-engine/install/)
on each host that you want to be part of the UCP cluster.

## Step 3: Customize named volumes

Docker UCP uses [named volumes](../architecture.md) to persist data. If you want
to customize the volume drivers and flags of these volumes, you can create the
volumes before installing UCP.

If the volumes don't exist, they are created when installing UCP with the
default volume driver and flags.


## Step 4: Customize the server certificates

The UCP cluster uses TLS to secure all communications. Two Certificate
Authorities (CA) are used for this:

* Cluster root CA: generates certificates for new nodes joining the cluster and
admin user bundles. The Cluster root CA is also used as an external CA in the
underlying Docker Engine Swarm Mode cluster.
* Client root CA: generates non-admin user bundles.

You can customize UCP to use certificates signed by an external Certificate
Authority. These certificates are used instead of the ones generated by the
client root CA. That way you can use a certificate from a CA that your
browsers and client tools already trust.

If you want to use your own certificates:

1. Log into the host where you intend to iniate the UCP install from.

2. Create a volume with the name `ucp-controller-server-certs`.

3. Add the following files to `/var/lib/docker/volumes/ucp-controller-server-certs/_data/`:

    | File     | Description                                                                       |
    |:---------|:----------------------------------------------------------------------------------|
    | ca.pem   | Your root CA certificate.                                                         |
    | cert.pem | Your signed UCP controller certificate followed by any intermediate certificates. |
    | key.pem  | Your UCP controller private key.                                                  |


## Step 5: Install UCP 

To install UCP you use the `docker/ucp` image. This image has commands to
install, configure, backup and restore UCP. To find what commands and options are
available, check the [reference documentation](../reference/install.md).

UCP can be either installed on top of an existing Docker Swarm Mode cluster, or
from scratch. In both cases, UCP controllers are installed on top of Swarm Mode
managers.

To install UCP on an existing swarm-mode cluster:

1. Log in to a shell session on one of the cluster's manager nodes 

2. Use the `docker/ucp install` command to install UCP.

    In this example we'll be running the install command interactively, so that
    the command prompts for the necessary configuration values.
    You can also use flags to pass values to the install command.

    ```bash
    $ docker run --rm -it --name ucp \
      -v /var/run/docker.sock:/var/run/docker.sock \
      docker/ucp install -i \
    ```

    Where:

    * i, specify to run the install command interactively,
    * Also, include the `--external-server-cert` flag if you want to configure
      UCP to user server certificates signed by an external CA during
	  installation. You can always configure this setting at a later stage.
	* If you're not using `--external-server-cert` at install time, you may need
	  to provide a `--san` flag to add any FQDNs or Load Balancer IP addresses
	  for your controller nodes to UCP's self-signed certificates. 
	* If you're not using `--external-server-cert` and  wish to specify different SANs 
	for each controller node in your cluster, you can manually
	specify SANs as a comma-separated list in the node label `com.docker.ucp.SANs` of your
	swarm-mode manager nodes using `docker node update`. You can also change SANs on a 
	per-node basis through the UI at `Admin Settings>Certificates`.

	When this command completes, UCP will be installed in every node of your
	original Swarm Mode cluster. 


3. Check that the UCP web application is running.

    In your browser, navigate to the address where you've installed UCP.

    If you're not using an external CA, your browser warns that UCP is
    an unsafe site. This happens because you're accessing UCP using HTTPS
    but the certificates used by UCP are not trusted by your browser.

    ![](../images/login.png)

To install UCP from scratch:

1. Log in to a shell session on a node which will become a UCP controller

2. Use the `docker/ucp install` command to install UCP on the current node. 
	You may use the `--host-address` flag to specify the IP address where all
	nodes in the cluster will be able to reach this controller, as well as all
	the flags mentioned in the previous section.

3. When the UCP installation completes, use `docker swarm join-token worker` and
   `docker swarm join-token manager` to obtain the commands with which you may
	join workers and managers in the cluster. Manager nodes will automatically become 
	UCP	controllers after they join the cluster.

4. Check that the UCP web application is running and inspect the join process.
    In your browser, navigate to the address where you've installed UCP.
	Log in as an admin user and navigate to Resources>Nodes. UCP is being
	installed on any nodes that appear to be down and you can view the
	installation logs for a given node by selecting the node and going to the
	`Agent Logs` page. You can also observe the status of the installation with
	a UCP admin client bundle through the `docker node ls` CLI command.

## Step 6: Add more nodes - Remove nodes

To add more nodes to your UCP cluster:

1. Obtain a join token for manager or worker nodes with the 
	`docker swarm join-token manager` and `docker swarm join-token worker`
	commands respectively.

2. Run the corresponding `docker swarm join` command on the new node that you
   wish to join to the cluster.

3. Wait for the node to be listed as `Ready` in the UCP UI or through `docker
   node ls` when using an admin client bundle


To remove nodes from your UCP cluster:

1. Remove the node from the User Interface

OR

1. Perform a `docker node rm` through a UCP admin bundle

## Step 6: License your installation

Before accessing the UCP Beta UI, you need to license your installation first.
[Learn how to license your installation](license.md).

## Step 7. Download a client certificate bundle

To validate that your cluster is correctly configured, you should try accessing
the cluster with the Docker CLI client. For this, you'll need to get a client
certificate bundle.
[Learn more about user bundles](../access-ucp/cli-based-access.md).


## Where to go next

* [Deploy an app from the UI](../applications/deploy-app-ui.md)
* [Monitor a UCP cluster](../monitor/monitor-ucp.md)
