<p>When you add a node to the cluster, the node’s workloads are managed by a
default orchestrator, either Docker Swarm or Kubernetes. When you install
Docker EE, new nodes are managed by Docker Swarm, but you can change the
default orchestrator to Kubernetes in the administrator settings.</p>

<p>Changing the default orchestrator doesn’t affect existing nodes in the cluster.
You can change the orchestrator type for individual nodes in the cluster
by navigating to the node’s configuration page in the Docker EE web UI.</p>

<h2 id="change-the-orchestrator-for-a-node">Change the orchestrator for a node</h2>

<p>You can change the current orchestrator for any node that’s joined to a
Docker EE cluster. The available orchestrator types are <strong>Kubernetes</strong>,
<strong>Swarm</strong>, and <strong>Mixed</strong>.</p>

<p>The <strong>Mixed</strong> type enables workloads to be scheduled by Kubernetes and Swarm
both on the same node. Although you can choose to mix orchestrator types on the
same node, this isn’t recommended for production deployments because of the
likelihood of resource contention.</p>

<p>Change a node’s orchestrator type on the <strong>Edit node</strong> page:</p>

<ol>
  <li>Log in to the Docker EE web UI with an administrator account.</li>
  <li>Navigate to the <strong>Nodes</strong> page, and click the node that you want to assign
to a different orchestrator.</li>
  <li>In the details pane, click <strong>Configure</strong> and select <strong>Details</strong> to open
the <strong>Edit node</strong> page.</li>
  <li>In the <strong>Orchestrator properties</strong> section, click the orchestrator type
for the node.</li>
  <li>
    <p>Click <strong>Save</strong> to assign the node to the selected orchestrator.</p>

    <p><img src="../../images/change-orchestrator-for-node-1.png" alt="" class="with-border" /></p>
  </li>
</ol>

<h2 id="what-happens-when-you-change-a-nodes-orchestrator">What happens when you change a node’s orchestrator</h2>

<p>When you change the orchestrator type for a node, existing workloads are
evicted, and they’re not migrated to the new orchestrator automatically.
If you want the workloads to be scheduled by the new orchestrator, you must
migrate them manually. For example, if you deploy WordPress on a Swarm
node, and you change the node’s orchestrator type to Kubernetes, Docker EE
doesn’t migrate the workload, and WordPress continues running on Swarm. In
this case, you must migrate your WordPress deployment to Kubernetes manually.</p>

<p>The following table summarizes the results of changing a node’s orchestrator.</p>

<table>
  <thead>
    <tr>
      <th>Workload</th>
      <th>On orchestrator change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Containers</td>
      <td>Container continues running in node</td>
    </tr>
    <tr>
      <td>Docker service</td>
      <td>Node is drained, and tasks are rescheduled to another node</td>
    </tr>
    <tr>
      <td>Pods and other imperative resources</td>
      <td>Continue running in node</td>
    </tr>
    <tr>
      <td>Deployments and other declarative resources</td>
      <td>Might change, but for now, continue running in node</td>
    </tr>
  </tbody>
</table>

<p>If a node is running containers, and you change the node to Kubernetes, these
containers will continue running, and Kubernetes won’t be aware of them, so
you’ll be in the same situation as if you were running in <code class="highlighter-rouge">Mixed</code> node.</p>

<blockquote class="warning">
  <p>Be careful when mixing orchestrators on a node.</p>

  <p>When you change a node’s orchestrator, you can choose to run the node in a
mixed mode, with both Kubernetes and Swarm workloads. The <code class="highlighter-rouge">Mixed</code> type
is not intended for production use, and it may impact existing workloads
on the node.</p>

  <p>This is because the two orchestrator types have different views of the node’s
resources, and they don’t know about each other’s workloads. One orchestrator
can schedule a workload without knowing that the node’s resources are already
committed to another workload that was scheduled by the other orchestrator.
When this happens, the node could run out of memory or other resources.</p>

  <p>For this reason, we recommend against mixing orchestrators on a production
node.</p>
</blockquote>

<h2 id="set-the-default-orchestrator-type-for-new-nodes">Set the default orchestrator type for new nodes</h2>

<p>You can set the default orchestrator for new nodes to <strong>Kubernetes</strong> or
<strong>Swarm</strong>.</p>

<p>To set the orchestrator for new nodes:</p>

<ol>
  <li>Log in to the Docker EE web UI with an administrator account.</li>
  <li>Open the <strong>Admin Settings</strong> page, and in the left pane, click <strong>Scheduler</strong>.</li>
  <li>Under <strong>Set orchestrator type for new nodes</strong> click <strong>Swarm</strong>
or <strong>Kubernetes</strong>.</li>
  <li>
    <p>Click <strong>Save</strong>.</p>

    <p><img src="../../images/join-nodes-to-cluster-1.png" alt="" class="with-border" /></p>
  </li>
</ol>

<p>From now on, when you join a node to the cluster, new workloads on the node
are scheduled by the specified orchestrator type. Existing nodes in the cluster
aren’t affected.</p>

<p>Once a node is joined to the cluster, you can
<a href="#change-the-orchestrator-for-a-node">change the orchestrator</a> that schedules its
workloads.</p>

<h2 id="choosing-the-orchestrator-type">Choosing the orchestrator type</h2>

<p>The workloads on your cluster can be scheduled by Kubernetes or by Swarm, or
the cluster can be mixed, running both orchestrator types. If you choose to
run a mixed cluster, be aware that the different orchestrators aren’t aware of
each other, and there’s no coordination between them.</p>

<p>We recommend that you make the decision about orchestration when you set up the
cluster initially. Commit to Kubernetes or Swarm on all nodes, or assign each
node individually to a specific orchestrator. Once you start deploying workloads,
avoid changing the orchestrator setting. If you do change the orchestrator for a
node, your workloads are evicted, and you must deploy them again through the
new orchestrator.</p>

<blockquote>
  <p>Node demotion and orchestrator type</p>

  <p>When you promote a worker node to be a manager, its orchestrator type
automatically changes to <code class="highlighter-rouge">Mixed</code>. If you demote the same node to be a worker,
its orchestrator type remains as <code class="highlighter-rouge">Mixed</code>.</p>
</blockquote>

<h2 id="use-the-cli-to-set-the-orchestrator-type">Use the CLI to set the orchestrator type</h2>

<p>Set the orchestrator on a node by assigning the orchestrator labels,
<code class="highlighter-rouge">com.docker.ucp.orchestrator.swarm</code> or <code class="highlighter-rouge">com.docker.ucp.orchestrator.kubernetes</code>,
to <code class="highlighter-rouge">true</code>.</p>

<p>To schedule Swarm workloads on a node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker node update <span class="nt">--label-add</span> com.docker.ucp.orchestrator.swarm<span class="o">=</span><span class="nb">true</span> &lt;node-id&gt;
</code></pre></div></div>

<p>To schedule Kubernetes workloads on a node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker node update <span class="nt">--label-add</span> com.docker.ucp.orchestrator.kubernetes<span class="o">=</span><span class="nb">true</span> &lt;node-id&gt;
</code></pre></div></div>

<p>To schedule Kubernetes and Swarm workloads on a node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker node update <span class="nt">--label-add</span> com.docker.ucp.orchestrator.swarm<span class="o">=</span><span class="nb">true</span> &lt;node-id&gt;
docker node update <span class="nt">--label-add</span> com.docker.ucp.orchestrator.kubernetes<span class="o">=</span><span class="nb">true</span> &lt;node-id&gt;
</code></pre></div></div>

<blockquote class="warning">
  <p>Mixed nodes</p>

  <p>Scheduling both Kubernetes and Swarm workloads on a node is not recommended
for production deployments, because of the likelihood of resource contention.</p>
</blockquote>

<p>To change the orchestrator type for a node from Swarm to Kubernetes:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker node update <span class="nt">--label-add</span> com.docker.ucp.orchestrator.kubernetes<span class="o">=</span><span class="nb">true</span> &lt;node-id&gt;
docker node update <span class="nt">--label-rm</span> com.docker.ucp.orchestrator.swarm &lt;node-id&gt;
</code></pre></div></div>

<p>UCP detects the node label change and updates the Kubernetes node accordingly.</p>

<p>Check the value of the orchestrator label by inspecting the node:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker node inspect &lt;node-id&gt; | <span class="nb">grep</span> <span class="nt">-i</span> orchestrator
</code></pre></div></div>

<p>The <code class="highlighter-rouge">docker node inspect</code> command returns the node’s configuration, including
the orchestrator:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"com.docker.ucp.orchestrator.kubernetes"</span>: <span class="s2">"true"</span>
</code></pre></div></div>

<blockquote class="important">
  <p>Orchestrator label</p>

  <p>The <code class="highlighter-rouge">com.docker.ucp.orchestrator</code> label isn’t displayed in the <strong>Labels</strong>
list for a node in the Docker EE web UI.</p>
</blockquote>

<h2 id="set-the-default-orchestrator-type-for-new-nodes-1">Set the default orchestrator type for new nodes</h2>

<p>The default orchestrator for new nodes is a setting in the Docker EE
configuration file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>default_node_orchestrator = "swarm"
</code></pre></div></div>

<p>The value can be <code class="highlighter-rouge">swarm</code> or <code class="highlighter-rouge">kubernetes</code>.</p>

<h2 id="where-to-go-next">Where to go next</h2>

<ul>
  <li><a href="ucp-configuration-file.md">Set up Docker EE by using a config file</a></li>
</ul>
