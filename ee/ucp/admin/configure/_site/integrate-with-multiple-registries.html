<p>Universal Control Plane can pull and run images from any image registry,
including Docker Trusted Registry and Docker Store.</p>

<p>If your registry uses globally-trusted TLS certificates, everything works
out of the box, and you donâ€™t need to configure anything. But if your registries
use self-signed certificates or certificates issues by your own Certificate
Authority, you need to configure UCP to trust those registries.</p>

<h2 id="trust-docker-trusted-registry">Trust Docker Trusted Registry</h2>

<p>To configure UCP to trust a DTR deployment, you need to update the
<a href="ucp-configuration-file.md">UCP system configuration</a> to include one entry for
each DTR deployment:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[[registries]]
  host_address = "dtr.example.org"
  ca_bundle = """
-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----"""

[[registries]]
  host_address = "internal-dtr.example.org:444"
  ca_bundle = """
-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----"""
</code></pre></div></div>

<p>You only need to include the port section if your DTR deployment is running
on a port other than 443.</p>

<p>You can customize and use the script below to generate a file named
<code class="highlighter-rouge">trust-dtr.toml</code> with the configuration needed for your DTR deployment.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Replace this url by your DTR deployment url and port
DTR_URL=https://dtr.example.org
DTR_PORT=443

dtr_full_url=${DTR_URL}:${DTR_PORT}
dtr_ca_url=${dtr_full_url}/ca

# Strip protocol and default https port
dtr_host_address=${dtr_full_url#"https://"}
dtr_host_address=${dtr_host_address%":443"}

# Create the registry configuration and save it it
cat &lt;&lt;EOL &gt; trust-dtr.toml

[[registries]]
  # host address should not contain protocol or port if using 443
  host_address = $dtr_host_address
  ca_bundle = """
$(curl -sk $dtr_ca_url)"""
EOL
</code></pre></div></div>

<p>You can then append the content of <code class="highlighter-rouge">trust-dtr.toml</code> to your current UCP
configuration to make UCP trust this DTR deployment.</p>

<h2 id="where-to-go-next">Where to go next</h2>

<ul>
  <li><a href="external-auth/enable-ldap-config-file.md">Integrate with LDAP by using a configuration file</a></li>
</ul>
