<p>Docker Enterprise Edition (EE) has its own image registry (DTR) so that
you can store and manage the images that you deploy to your cluster.
In this topic, you push an image to DTR and later deploy it to your cluster,
using the Kubernetes orchestrator.</p>

<h2 id="open-the-dtr-web-ui">Open the DTR web UI</h2>

<ol>
  <li>In the Docker EE web UI, click <strong>Admin Settings</strong>.</li>
  <li>In the left pane, click <strong>Docker Trusted Registry</strong>.</li>
  <li>
    <p>In the <strong>Installed DTRs</strong> section, note the URL of your cluster’s DTR
instance.</p>

    <p><img src="../../images/manage-and-deploy-private-images-1.png" alt="" class="with-border" /></p>
  </li>
  <li>In a new browser tab, enter the URL to open the DTR web UI.</li>
</ol>

<h2 id="create-an-image-repository">Create an image repository</h2>

<ol>
  <li>In the DTR web UI, click <strong>Repositories</strong>.</li>
  <li>Click <strong>New Repository</strong>, and in the <strong>Repository Name</strong> field, enter
“wordpress”.</li>
  <li>
    <p>Click <strong>Save</strong> to create the repository.</p>

    <p><img src="../../images/manage-and-deploy-private-images-2.png" alt="" class="with-border" /></p>
  </li>
</ol>

<h2 id="push-an-image-to-dtr">Push an image to DTR</h2>

<p>Instead of building an image from scratch, we’ll pull the official WordPress
image from Docker Hub, tag it, and push it to DTR. Once that WordPress version
is in DTR, only authorized users can change it.</p>

<p>To push images to DTR, you need CLI access to a licensed installation of
Docker EE.</p>

<ul>
  <li><a href="license-your-installation.md">License your installation</a>.</li>
  <li><a href="../../user-acccess/cli.md">Set up your Docker CLI</a>.</li>
</ul>

<p>When you’re set up for CLI-based access to a licensed Docker EE instance,
you can push images to DTR.</p>

<ol>
  <li>
    <p>Pull the public WordPress image from Docker Hub:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull wordpress
</code></pre></div>    </div>
  </li>
  <li>
    <p>Tag the image, using the IP address or DNS name of your DTR instance:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag wordpress:latest &lt;dtr-url&gt;:&lt;port&gt;/admin/wordpress:latest
</code></pre></div>    </div>
  </li>
  <li>Log in to a Docker EE manager node.</li>
  <li>
    <p>Push the tagged image to DTR:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker image push &lt;dtr-url&gt;:&lt;port&gt;/admin/wordpress:latest
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="confirm-the-image-push">Confirm the image push</h2>

<p>In the DTR web UI, confirm that the <code class="highlighter-rouge">wordpress:latest</code> image is store in your
DTR instance.</p>

<ol>
  <li>In the DTR web UI, click <strong>Repositories</strong>.</li>
  <li>Click <strong>wordpress</strong> to open the repo.</li>
  <li>Click <strong>Images</strong> to view the stored images.</li>
  <li>
    <p>Confirm that the <code class="highlighter-rouge">latest</code> tag is present.</p>

    <p><img src="../../images/manage-and-deploy-private-images-3.png" alt="" class="with-border" /></p>
  </li>
</ol>

<p>You’re ready to deploy the <code class="highlighter-rouge">wordpress:latest</code> image into production.</p>

<h2 id="deploy-the-private-image-to-ucp">Deploy the private image to UCP</h2>

<p>With the WordPress image stored in DTR, Docker EE can deploy the image to a
Kubernetes cluster with a simple Deployment object:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1beta2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">wordpress-deployment</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">wordpress</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">2</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">wordpress</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">wordpress</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">&lt;dtr-url&gt;:&lt;port&gt;/admin/wordpress:latest</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">80</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">wordpress-service</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">wordpress</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="s">80</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="s">30081</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">wordpress</span>
</code></pre></div></div>

<p>The Deployment object’s YAML specifies your DTR image in the pod template spec:
<code class="highlighter-rouge">image: &lt;dtr-url&gt;:&lt;port&gt;/admin/wordpress:latest</code>. Also, the YAML file defines
a <code class="highlighter-rouge">NodePort</code> service that exposes the WordPress application, so it’s accessible
from outside the cluster.</p>

<ol>
  <li>Open the Docker EE web UI, and in the left pane, click <strong>Kubernetes</strong>.</li>
  <li>Click <strong>Create</strong> to open the <strong>Create Kubernetes Object</strong> page.</li>
  <li>In the <strong>Namespace</strong> dropdown, select <strong>default</strong>.</li>
  <li>In the <strong>Object YAML</strong> editor, paste the Deployment object’s YAML.</li>
  <li>Click <strong>Create</strong>. When the Kubernetes objects are created,
the <strong>Load Balancers</strong> page opens.</li>
  <li>Click <strong>wordpress-service</strong>, and in the details pane, find the <strong>Ports</strong>
section.</li>
  <li>
    <p>Click the URL to open the default WordPress home page.</p>

    <p><img src="../../images/manage-and-deploy-private-images-4.png" alt="" class="with-border" /></p>
  </li>
</ol>

