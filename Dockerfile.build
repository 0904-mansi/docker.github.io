FROM golang:1.6.2-alpine

#RUN curl -sL https://deb.nodesource.com/setup_0.12 | bash -
RUN apk add --update ca-certificates nodejs jq curl git make python py-pip openssh-client bash

RUN go get github.com/tools/godep

ENV MACHINE_VERSION v0.7.0
ENV NOTARY_VERSION v0.3.0
# explicitly set $SHELL for docker-machine >=0.6
ENV SHELL sh

# tar -O extracts to STDOUT, -z is needed for busybox tar to handle gzip
RUN for VER in 1.11.1 ; do \
    curl -L https://get.docker.com/builds/Linux/x86_64/docker-${VER}.tgz | tar -xzO docker/docker > /usr/bin/docker-${VER} && \
    ln -s /usr/bin/docker-1.11.1 /usr/bin/docker ; \
    done && \
    chmod a+x /usr/bin/docker-*

RUN for VER in 1.5.0 1.6.2 1.7.1 1.8.3 1.9.1 1.10.3 ; do \
    curl -L https://get.docker.com/builds/Linux/x86_64/docker-${VER} > /usr/bin/docker-${VER} ; \
    done && \
    chmod a+x /usr/bin/docker-* && \
    curl -L https://github.com/docker/machine/releases/download/${MACHINE_VERSION}/docker-machine-Linux-x86_64 >/usr/bin/docker-machine && \
    chmod +x /usr/bin/docker-machine && \
    curl -L https://github.com/docker/notary/releases/download/${NOTARY_VERSION}/notary-Linux-static-amd64 >/usr/bin/notary && \
    chmod +x /usr/bin/notary && \
    pip install docker-compose



# extra test dependencies
RUN go get -d \
        github.com/stretchr/testify/assert \
        github.com/stretchr/objx \
        github.com/gorilla/websocket


WORKDIR /go/src/github.com/docker/orca
RUN ln -s /go/src/github.com/docker/orca/controller/controller /bin/controller

COPY . /go/src/github.com/docker/orca
